# SCUD Graph v1
# Phase: init

@meta {
  name init
  updated 2025-12-04T23:25:19.992007+00:00
}

@nodes
# id | title | status | complexity | priority
1 | Set up project scaffold with Bun, Hono, Vite, and Solid.js | P | 2 | H
2 | Define system prompt and tool definitions | P | 1 | H
3 | Implement core agent loop with Anthropic SDK | X | 3 | H
3.1 | Set up Anthropic SDK integration | P | 0 | H
3.2 | Implement core message handling loop | P | 0 | H
3.3 | Add tool call processing and error handling | P | 0 | H
4 | Implement tool execution functions | X | 5 | H
4.1 | Implement read_file function | P | 0 | H
4.2 | Implement write_file function | P | 0 | H
4.3 | Implement edit_file function | P | 0 | H
4.4 | Implement bash function | P | 0 | H
5 | Set up SSE endpoint for streaming events | X | 3 | H
5.1 | Define event schemas for agent events | P | 0 | H
5.2 | Implement SSE endpoint in Hono | P | 0 | H
5.3 | Integrate SSE with agent loop | P | 0 | H
6 | Build basic chat UI with message list and input | X | 3 | H
6.1 | Create message display component | P | 0 | H
6.2 | Add message input and sending functionality | P | 0 | H
6.3 | Integrate SSE for real-time streaming | P | 0 | H
7 | Add tool call visualization in UI | X | 5 | H
7.1 | Define Tool Call Data Models | P | 0 | H
7.2 | Implement SSE Event Handling Logic | P | 0 | H
7.3 | Create UI Components for Tool Call Visualization | P | 0 | H
7.4 | Integrate and Test Tool Call Visualization | P | 0 | M
8 | Implement partial JSON streaming for tool inputs | X | 3 | M
8.1 | Update data models for partial JSON streaming | P | 0 | H
8.2 | Enhance agent loop and SSE for streaming partial tool arguments | P | 0 | H
8.3 | Update UI to display progressive tool inputs | P | 0 | H
9 | Add token counter and command preview features | P | 2 | M
10 | Implement session persistence and final polish | X | 5 | M
10.1 | Define conversation data schema | P | 0 | H
10.2 | Implement save and load functions | P | 0 | H
10.3 | Integrate save/load UI and error handling | P | 0 | M
10.4 | Final polish and documentation | P | 0 | L

@edges
# dependent -> dependency
2 -> 1
3 -> 2
3.2 -> 3.1
3.3 -> 3.2
4 -> 3
5 -> 4
5.2 -> 5.1
5.3 -> 5.2
6 -> 5
6.2 -> 6.1
6.3 -> 6.1
6.3 -> 6.2
7 -> 6
7.2 -> 7.1
7.3 -> 7.1
7.3 -> 7.2
7.4 -> 7.3
8 -> 7
8.2 -> 8.1
8.3 -> 8.2
9 -> 8
10 -> 9
10.2 -> 10.1
10.3 -> 10.2
10.4 -> 10.3

@parents
# parent: subtasks...
3: 3.1, 3.2, 3.3
4: 4.1, 4.2, 4.3, 4.4
5: 5.1, 5.2, 5.3
6: 6.1, 6.2, 6.3
7: 7.1, 7.2, 7.3, 7.4
8: 8.1, 8.2, 8.3
10: 10.1, 10.2, 10.3, 10.4

@details
1 | description |
  Initialize a new project using Bun, set up Hono for the server, Vite for frontend build, and Solid.js with Tailwind for UI. Ensure dependencies like Anthropic SDK and Zod are installed. Success: Project runs locally with a basic Hello World page.
2 | description |
  Create the minimal system prompt (~600 tokens) and define the 4 core tools (read_file, write_file, edit_file, bash) using Anthropic SDK format with Zod validation. Success: Tools are properly structured and can be imported without errors.
3 | description |
  Build the main agent logic that handles user messages, calls the Anthropic API, and processes tool calls in a loop. Include basic error handling. Success: Agent can respond to simple text inputs without tools.
3.1 | description |
  Initialize the Anthropic client, define message schemas or structures for user inputs and API responses, and ensure basic connection to the API. This includes importing necessary libraries and setting up configuration.
3.2 | description |
  Build the main loop that receives user messages, sends them to the Anthropic API, and returns responses. Focus on simple text inputs without tools, ensuring the loop can process messages iteratively.
3.3 | description |
  Extend the loop to handle tool calls from the API responses, including invocation and result processing. Incorporate basic error handling for API failures, invalid inputs, and loop interruptions.
4 | description |
  Create functions for each tool (read_file, write_file, edit_file, bash) with proper file I/O and command execution. Add basic validation and error handling. Success: Each tool can be executed manually and returns expected outputs.
4.1 | description |
  Create the read_file function with proper file reading capabilities, input validation (e.g., file path exists and is readable), error handling (e.g., file not found), and return the file contents as expected output.
4.2 | description |
  Create the write_file function with proper file writing capabilities, input validation (e.g., valid file path and content), error handling (e.g., permission denied or disk space issues), and ensure it writes to the file successfully.
4.3 | description |
  Create the edit_file function with proper file editing capabilities (e.g., search and replace), input validation (e.g., file exists and edit parameters are valid), error handling (e.g., invalid edit requests), and return confirmation of changes.
4.4 | description |
  Create the bash function with proper command execution, input validation (e.g., safe command strings), error handling (e.g., command failures or timeouts), and return the command output or error messages.
5 | description |
  Configure Hono to serve an SSE endpoint that streams agent events (text_delta, tool_start, etc.) to the frontend. Integrate with the agent loop. Success: Frontend can receive real-time events from a test agent call.
5.1 | description |
  Create TypeScript interfaces or schemas for agent event types like text_delta, tool_start, etc., to ensure consistent data structure for SSE streaming.
5.2 | description |
  Configure Hono to set up an SSE endpoint that can stream events to the frontend, including proper headers and connection handling.
5.3 | description |
  Modify the agent loop to emit real-time events (text_delta, tool_start, etc.) to the SSE endpoint, and verify with a test agent call that the frontend receives them.
6 | description |
  Create a Solid.js component for displaying user and agent messages, with an input field to send messages. Connect to the SSE endpoint for streaming text. Success: Users can send messages and see agent responses stream in real-time.
6.1 | description |
  Build a Solid.js component that renders a list of messages (user and agent) with appropriate styling and layout. This component should accept an array of message objects and display them in chronological order.
6.2 | description |
  Extend the chat component by adding an input field for users to type messages and a send button. Implement the logic to capture user input, add it to the message list, and prepare for sending to the backend.
6.3 | description |
  Connect the chat component to the SSE endpoint to receive streaming text responses from the agent. Update the message list in real-time as chunks of the agent's response arrive, ensuring smooth streaming display.
7 | description |
  Implement UI components to display tool calls with status (start, running, result), including spinners and output. Handle tool events from SSE. Success: Tool calls appear as cards in the chat with real-time updates.
7.1 | description |
  Create TypeScript interfaces or models for tool call events, including properties like status (start, running, result), tool name, inputs, outputs, and timestamps. This will serve as the foundation for handling and displaying tool calls.
7.2 | description |
  Add logic to listen for Server-Sent Events (SSE) related to tool calls, parse the events, and update the application state accordingly. This includes managing real-time updates for tool call statuses.
7.3 | description |
  Develop React components to render tool calls as cards in the chat UI, including spinners for running status, output display for results, and visual indicators for start and completion states.
7.4 | description |
  Integrate the UI components into the chat interface, ensure real-time updates from SSE, and add unit tests for components and integration tests for the full feature to verify tool calls appear correctly with updates.
8 | description |
  Enhance the agent loop and SSE to stream partial tool arguments as JSON arrives. Update UI to show building tool inputs. Success: Tool arguments appear progressively in the UI during streaming.
8.1 | description |
  Modify or create schemas and models to handle partial JSON structures for tool arguments, ensuring they can be parsed and streamed incrementally.
8.2 | description |
  Update the agent loop and Server-Sent Events (SSE) mechanism to stream partial JSON tool arguments as they arrive, enabling real-time transmission of building inputs.
8.3 | description |
  Modify the user interface to render partial tool arguments progressively during streaming, showing building inputs in real-time.
9 | description |
  Integrate a context usage indicator in the UI and add a command preview for bash tool calls to warn about dangerous commands. Success: UI shows token count and previews bash commands before execution.
10 | description |
  Add functionality to save/load conversations as JSON files. Perform final error handling, styling, and write a README. Success: Sessions can be saved/reloaded, and the app is demo-ready with no obvious bugs.
10.1 | description |
  Create a JSON schema or data model to represent conversation sessions, including messages, timestamps, and metadata for saving and loading.
10.2 | description |
  Develop core logic to serialize conversations to JSON files and deserialize them back into the app state, ensuring data integrity.
10.3 | description |
  Add UI elements (e.g., buttons or menus) for saving and loading sessions, and implement error handling for file operations and invalid data.
10.4 | description |
  Apply final styling improvements, fix any remaining bugs, perform manual testing for demo readiness, and write a comprehensive README with usage instructions.
